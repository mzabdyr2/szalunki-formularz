<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABC Szalunki - Formularz Dzier≈ºawy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- PDFMAKE - OBS≈ÅUGA POLSKICH ZNAK√ìW -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.min.js"></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-red-600 py-8">
        <div class="container mx-auto px-4 text-center">
            <div class="text-4xl font-bold text-red-600 mb-4">üèóÔ∏è ABC SZALUNKI</div>
            <h1 class="text-2xl md:text-3xl text-gray-800 font-bold mb-2">Formularz Dzier≈ºawy</h1>
            <p class="text-lg text-gray-600">Za≈ÇƒÖcznik nr 4 - Dane kontaktowe Dzier≈ºawcy</p>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <form id="formularzForm" class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-8">

            <!-- Typ dzier≈ºawcy -->
            <div class="mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Typ dzier≈ºawcy *</h3>
                <div class="flex gap-8">
                    <label class="flex items-center p-6 border-2 border-gray-300 rounded-lg hover:border-red-600 cursor-pointer">
                        <input type="radio" name="clientType" value="firma" class="w-5 h-5 text-red-600" onchange="toggleClientType()" required>
                        <span class="ml-4 font-medium text-lg">Firma</span>
                    </label>
                    <label class="flex items-center p-6 border-2 border-gray-300 rounded-lg hover:border-red-600 cursor-pointer">
                        <input type="radio" name="clientType" value="osoba" class="w-5 h-5 text-red-600" onchange="toggleClientType()" required>
                        <span class="ml-4 font-medium text-lg">Osoba fizyczna</span>
                    </label>
                </div>
            </div>

            <!-- Sekcja Firma -->
            <div id="firmaSection" class="hidden mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">1. Dane dzier≈ºawcy - firma</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">NIP *</label>
                        <input type="text" name="nip" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">REGON</label>
                        <input type="text" name="regon" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">KRS</label>
                        <input type="text" name="krs" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Osoba upowa≈ºniona do podpisania umowy *</label>
                        <input type="text" name="authorizedPerson" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Telefon *</label>
                        <input type="tel" name="phone" placeholder="+48 123 456 789" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                    </div>
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">E-mail do faktur *</label>
                    <input type="email" name="invoiceEmail" placeholder="faktury@firma.pl" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                </div>

                <!-- Osoba wnioskujƒÖca dla firmy -->
                <div class="bg-gray-50 p-4 rounded-lg mb-4">
                    <h4 class="text-lg font-medium text-gray-800 mb-3">Osoba wnioskujƒÖca (je≈õli inna ni≈º dzier≈ºawca)</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Imiƒô i nazwisko</label>
                            <span class="text-xs text-gray-500 block mb-2">Opcjonalne</span>
                            <input type="text" name="applicantNameCompany" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Telefon</label>
                            <span class="text-xs text-gray-500 block mb-2">Opcjonalne</span>
                            <input type="tel" name="applicantPhoneCompany" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">E-mail</label>
                            <span class="text-xs text-gray-500 block mb-2">Opcjonalne</span>
                            <input type="email" name="applicantEmailCompany" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sekcja Osoba fizyczna -->
            <div id="osobaSection" class="hidden mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">1. Dane dzier≈ºawcy - osoba fizyczna</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Imiƒô i nazwisko *</label>
                        <input type="text" name="fullName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">PESEL</label>
                        <input type="text" name="pesel" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Telefon *</label>
                        <input type="tel" name="phonePrivate" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">E-mail *</label>
                        <input type="email" name="emailPrivate" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                    </div>
                </div>

                <!-- Osoba wnioskujƒÖca -->
                <div class="bg-gray-50 p-4 rounded-lg mb-4">
                    <h4 class="text-lg font-medium text-gray-800 mb-3">Osoba wnioskujƒÖca (je≈õli inna ni≈º dzier≈ºawca)</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Imiƒô i nazwisko</label>
                            <span class="text-xs text-gray-500 block mb-2">Opcjonalne</span>
                            <input type="text" name="applicantName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Telefon</label>
                            <span class="text-xs text-gray-500 block mb-2">Opcjonalne</span>
                            <input type="tel" name="applicantPhone" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">E-mail</label>
                            <span class="text-xs text-gray-500 block mb-2">Opcjonalne</span>
                            <input type="email" name="applicantEmail" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                        </div>
                    </div>
                </div>
            </div>

            <!-- REGION - NOWA SEKCJA -->
            <div class="mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">Region *</h3>
                <p class="text-sm text-gray-600 mb-4">Wybierz region, w kt√≥rym znajduje siƒô budowa:</p>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <label class="flex items-center p-4 border-2 border-gray-300 rounded-lg hover:border-red-600 cursor-pointer transition">
                        <input type="radio" name="region" value="Krak√≥w" class="w-5 h-5 text-red-600" required>
                        <span class="ml-3 font-medium"> Krak√≥w</span>
                    </label>
                    
                    <label class="flex items-center p-4 border-2 border-gray-300 rounded-lg hover:border-red-600 cursor-pointer transition">
                        <input type="radio" name="region" value="≈ölƒÖsk" class="w-5 h-5 text-red-600" required>
                        <span class="ml-3 font-medium"> ≈ölƒÖsk</span>
                    </label>
                    
                    <label class="flex items-center p-4 border-2 border-gray-300 rounded-lg hover:border-red-600 cursor-pointer transition">
                        <input type="radio" name="region" value="≈Å√≥d≈∫" class="w-5 h-5 text-red-600" required>
                        <span class="ml-3 font-medium"> ≈Å√≥d≈∫</span>
                    </label>
                </div>
            </div>

            <!-- 2. Inwestycja -->
            <div class="mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">2. Inwestycja</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nazwa inwestycji *</label>
                        <span class="text-xs text-gray-500 block mb-2">Nazwa projektu budowlanego</span>
                        <input type="text" name="investmentName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Adres budowy *</label>
                        <span class="text-xs text-gray-500 block mb-2">Adres lokalizacji budowy</span>
                        <input type="text" name="constructionAddress" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600" required>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Data rozpoczƒôcia *</label>
                        <span class="text-xs text-gray-500 block mb-2">dd.mm.rrrr</span>
                        <input type="date" name="startDate" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Przewidywany okres dzier≈ºawy *</label>
                        <select name="rentalPeriod" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600" required>
                            <option value="">Wybierz okres</option>
                            <option value="8 dni">8 dni</option>
                            <option value="10-15 dni">10-15 dni</option>
                            <option value="15-30 dni">15-30 dni</option>
                            <option value="30-60 dni">30-60 dni</option>
                            <option value="60 dni i wiƒôcej">60 dni i wiƒôcej</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- 3. Wykonawca -->
            <div class="mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">3. Wykonawca</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nazwa wykonawcy *</label>
                        <span class="text-xs text-gray-500 block mb-2">Nazwa firmy wykonawczej</span>
                        <input type="text" name="contractorName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Osoba kontaktowa</label>
                        <span class="text-xs text-gray-500 block mb-2">Imiƒô i nazwisko</span>
                        <input type="text" name="contactPerson" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Telefon</label>
                        <span class="text-xs text-gray-500 block mb-2">Telefon kontaktowy</span>
                        <input type="tel" name="contractorPhone" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Telefon na budowƒô</label>
                        <span class="text-xs text-gray-500 block mb-2">Telefon na budowƒô</span>
                        <input type="tel" name="constructionPhone" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Dodatkowe informacje</label>
                    <textarea name="contractorNotes" rows="2" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600"></textarea>
                </div>
            </div>

            <!-- 4. Inwestor -->
            <div class="mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">4. Inwestor</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nazwa inwestora</label>
                        <input type="text" name="investorName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">NIP inwestora</label>
                        <input type="text" name="investorNip" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Telefon</label>
                        <input type="tel" name="investorPhone" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">E-mail</label>
                        <input type="email" name="investorEmail" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                    </div>
                </div>
            </div>

            <!-- 5. Generalny Wykonawca -->
            <div class="mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">5. Generalny Wykonawca</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nazwa generalnego wykonawcy</label>
                        <input type="text" name="generalContractorName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">NIP generalnego wykonawcy</label>
                        <input type="text" name="generalContractorNip" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Telefon</label>
                        <input type="tel" name="generalContractorPhone" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                    </div>
                </div>
            </div>

            <!-- 6. Kierownik budowy -->
            <div class="mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">6. Kierownik budowy</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Imiƒô i nazwisko</label>
                        <input type="text" name="constructionManagerName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Telefon</label>
                        <input type="tel" name="constructionManagerPhone" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">E-mail</label>
                        <input type="email" name="constructionManagerEmail" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
                    </div>
                </div>
            </div>

            <!-- 7. Uwagi -->
            <div class="mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">7. Uwagi/opis zapotrzebowania</h3>
                <textarea name="requirements" rows="4" placeholder="Szczeg√≥≈Çowy opis potrzeb dotyczƒÖcych dzier≈ºawy szalunk√≥w..." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600"></textarea>
            </div>

            <!-- 8. SkƒÖd kontakt -->
            <div class="mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">8. SkƒÖd kontakt do ABC Szalunki</h3>
                <input type="text" name="contactSource" placeholder="np. strona internetowa, polecenie, reklama" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-600">
            </div>

            <!-- RODO -->
            <div class="mb-8 p-4 bg-gray-100 rounded-lg">
                <h4 class="font-bold text-gray-800 mb-3">Informacja o przetwarzaniu danych osobowych:</h4>
                <div class="text-sm text-gray-700 space-y-3">
                    <p>Zgodnie z ustawƒÖ odno≈õnie ochrony danych osobowych oraz RozporzƒÖdzenia Parlamentu Europejskiego i Rady (UE) 2016/679 Administratorem Danych Osobowych (ADO) jest Grupa ABC szalunki reprezentowana przez: <br><br>
                    ABC Szalunki Zbigniew Szarawarski NIP: 6791745313, Regon: 389446266; Adres: Skotnicka 272; 30-394 Krak√≥w, <br>
                    Maciej Szarawarski PHU PRATA NIP: 6762382380; Regon: 121462445; Adres: Skotnicka 272, 30-394 Krak√≥w,<br>
                    PRATA Sp. z o. o.; Nr KRS 0000906409; NIP 6762599837; Regon: 389416733; Adres: ul. Skotnicka 272, 30-394 Krak√≥w.</p>
                    
                    <p>Dane przetwarzane sƒÖ w celu: przedstawienia oferty umowy, realizacji zawartej umowy, dzia≈Ça≈Ñ marketingu bezpo≈õredniego oferowanych przez ADO us≈Çug, spe≈Çnienia obowiƒÖzku wynikajƒÖcego z przepis√≥w prawa, a zw≈Çaszcza zwiƒÖzanych z ustawƒÖ o rachunkowo≈õci, sƒÖ niezbƒôdne celem w≈Ça≈õciwej realizacji Umowy.</p>
                    
                    <p>Odbiorcami udostƒôpnionych danych osobowych bƒôdzie wy≈ÇƒÖcznie ADO oraz podmioty wsp√≥≈ÇpracujƒÖce z nim w ramach prowadzonej przez niego dzia≈Çalno≈õci gospodarczej.</p>
                    
                    <p>Podanie danych jest dobrowolne, jednak brak ich udostƒôpnienia skutkuje brakiem mo≈ºliwo≈õci realizacji zawartej z ADO Umowy.</p>
                </div>
                
                <label class="flex items-start mt-4">
                    <input type="checkbox" name="dataConsent" required class="w-5 h-5 text-red-600 mt-1 mr-3 flex-shrink-0">
                    <span class="text-sm text-gray-700">Potwierdzam zgodno≈õƒá danych do umowy i wyra≈ºam zgodƒô na przetwarzanie moich danych osobowych zgodnie z powy≈ºszƒÖ informacjƒÖ. *</span>
                </label>
            </div>

            <!-- Status -->
            <div id="statusMessage" class="mb-4 p-3 rounded-lg hidden"></div>

            <!-- Przycisk -->
            <div class="text-center">
                <button type="button" onclick="submitForm()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-4 px-8 rounded-lg transition-colors text-lg shadow-lg">
                    üìÑ Wy≈õlij formularz
                </button>
            </div>
        </form>
    </main>

    <script>
        // ==========================================
        // KONFIGURACJA
        // ==========================================
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzIQmZCR4l4ulEZYk_NMmJeFVjM3mg8_tT0qbqr57i-l_Se2R3-dTMPPKrV8IhuRKPyUw/exec';
        const SHEET_ID = '117ZPtH4-2vgDPQh-tInjyjI9GE5xN82evgVFikvcNFQ';

        function toggleClientType() {
            const clientType = document.querySelector('input[name="clientType"]:checked')?.value;
            const firmaSection = document.getElementById('firmaSection');
            const osobaSection = document.getElementById('osobaSection');
            
            if (clientType === 'firma') {
                firmaSection.classList.remove('hidden');
                osobaSection.classList.add('hidden');
            } else if (clientType === 'osoba') {
                osobaSection.classList.remove('hidden');
                firmaSection.classList.add('hidden');
            }
        }

        function collectFormData() {
            const formData = {};
            const inputs = document.querySelectorAll('input, textarea, select');
            inputs.forEach(input => {
                if (input.type === 'radio' || input.type === 'checkbox') {
                    if (input.checked) formData[input.name] = input.value;
                } else {
                    formData[input.name] = input.value || '';
                }
            });
            return formData;
        }

        // ==========================================
        // FUNKCJA GENEROWANIA PDF - PDFMAKE Z POLSKIMI ZNAKAMI
        // ==========================================
        function createPDFWithNativeText(formData) {
            const content = [];
            
            // HEADER - czerwone t≈Ço
            content.push({
                table: {
                    widths: ['*'],
                    body: [
                        [{ text: 'ABC SZALUNKI', style: 'header', alignment: 'center', fillColor: '#dc2626', color: '#ffffff', margin: [0, 10, 0, 5] }],
                        [{ text: 'FORMULARZ DZIER≈ªAWY', style: 'subheader', alignment: 'center', fillColor: '#dc2626', color: '#ffffff', margin: [0, 0, 0, 5] }],
                        [{ text: 'Za≈ÇƒÖcznik nr 4 - Dane kontaktowe Dzier≈ºawcy', alignment: 'center', fillColor: '#dc2626', color: '#ffffff', margin: [0, 0, 0, 10] }]
                    ]
                },
                layout: 'noBorders',
                margin: [0, 0, 0, 20]
            });
            
            // Funkcja dodawania sekcji
            function addSection(title) {
                content.push({
                    text: title,
                    style: 'sectionHeader',
                    margin: [0, 10, 0, 5]
                });
                content.push({
                    canvas: [
                        {
                            type: 'line',
                            x1: 0, y1: 0,
                            x2: 515, y2: 0,
                            lineWidth: 1,
                            lineColor: '#dc2626'
                        }
                    ],
                    margin: [0, 0, 0, 10]
                });
            }
            
            // Funkcja dodawania pola
            function addField(label, value) {
                if (!value) return;
                content.push({
                    text: [
                        { text: label + ':\n', bold: true, fontSize: 9, color: '#3c3c3c' },
                        { text: value + '\n', fontSize: 9 }
                    ],
                    margin: [0, 2, 0, 4]
                });
            }
            
            // TYP DZIER≈ªAWCY
            addSection('TYP DZIER≈ªAWCY');
            const clientTypeText = formData.clientType === 'firma' ? 'Firma' : 
                                 formData.clientType === 'osoba' ? 'Osoba fizyczna' : 'Nie wybrano';
            addField('Wybrany typ', clientTypeText);
            addField('Region', formData.region || 'Nie wybrano');
            
            // DANE FIRMY
            if (formData.clientType === 'firma') {
                addSection('1. DANE DZIER≈ªAWCY - FIRMA');
                addField('NIP', formData.nip);
                addField('REGON', formData.regon);
                addField('Telefon', formData.phone);
                addField('E-mail do faktur', formData.invoiceEmail);
                
                if (formData.applicantNameCompany || formData.applicantPhoneCompany || formData.applicantEmailCompany) {
                    content.push({ text: 'Osoba wnioskujƒÖca (je≈õli inna ni≈º dzier≈ºawca):', bold: true, margin: [0, 5, 0, 3], color: '#666666' });
                    addField('Imiƒô i nazwisko', formData.applicantNameCompany);
                    addField('Telefon', formData.applicantPhoneCompany);
                    addField('E-mail', formData.applicantEmailCompany);
                }
            }
            
            // DANE OSOBY FIZYCZNEJ
            if (formData.clientType === 'osoba') {
                addSection('1. DANE DZIER≈ªAWCY - OSOBA FIZYCZNA');
                addField('Imiƒô i nazwisko', formData.fullName);
                addField('PESEL', formData.pesel);
                addField('Telefon', formData.phonePrivate);
                addField('E-mail', formData.emailPrivate);
                
                if (formData.applicantName || formData.applicantPhone || formData.applicantEmail) {
                    content.push({ text: 'Osoba wnioskujƒÖca (je≈õli inna ni≈º dzier≈ºawca):', bold: true, margin: [0, 5, 0, 3], color: '#666666' });
                    addField('Imiƒô i nazwisko', formData.applicantName);
                    addField('Telefon', formData.applicantPhone);
                    addField('E-mail', formData.applicantEmail);
                }
            }
            
            // INWESTYCJA
            addSection('2. INWESTYCJA');
            addField('Nazwa inwestycji', formData.investmentName);
            addField('Adres budowy', formData.constructionAddress);
            addField('Data rozpoczƒôcia', formData.startDate);
            addField('Przewidywany okres dzier≈ºawy', formData.rentalPeriod);
            
            // WYKONAWCA
            addSection('3. WYKONAWCA');
            addField('Nazwa wykonawcy', formData.contractorName);
            addField('Osoba kontaktowa', formData.contactPerson);
            addField('Telefon kontaktowy', formData.contractorPhone);
            addField('Telefon na budowƒô', formData.constructionPhone);
            addField('Dodatkowe informacje', formData.contractorNotes);
            
            // INWESTOR
            if (formData.investorName || formData.investorNip || formData.investorPhone || formData.investorEmail) {
                addSection('4. INWESTOR');
                addField('Nazwa inwestora', formData.investorName);
                addField('NIP inwestora', formData.investorNip);
                addField('Telefon', formData.investorPhone);
                addField('E-mail', formData.investorEmail);
            }
            
            // GENERALNY WYKONAWCA
            if (formData.generalContractorName || formData.generalContractorNip || formData.generalContractorPhone) {
                addSection('5. GENERALNY WYKONAWCA');
                addField('Nazwa generalnego wykonawcy', formData.generalContractorName);
                addField('NIP generalnego wykonawcy', formData.generalContractorNip);
                addField('Telefon', formData.generalContractorPhone);
            }
            
            // KIEROWNIK BUDOWY
            if (formData.constructionManagerName || formData.constructionManagerPhone || formData.constructionManagerEmail) {
                addSection('6. KIEROWNIK BUDOWY');
                addField('Imiƒô i nazwisko', formData.constructionManagerName);
                addField('Telefon', formData.constructionManagerPhone);
                addField('E-mail', formData.constructionManagerEmail);
            }
            
            // UWAGI
            if (formData.requirements) {
                addSection('7. UWAGI/OPIS ZAPOTRZEBOWANIA');
                addField('Opis', formData.requirements);
            }
            
            // ≈πR√ìD≈ÅO KONTAKTU
            if (formData.contactSource) {
                addSection('8. ≈πR√ìD≈ÅO KONTAKTU DO ABC SZALUNKI');
                addField('SkƒÖd kontakt', formData.contactSource);
            }
            
            // ZGODA RODO
            addSection('ZGODA RODO');
            const rodoStatus = formData.dataConsent ? 'WYRA≈ªONA' : 'NIE WYRA≈ªONA';
            addField('Status zgody na przetwarzanie danych osobowych', rodoStatus);
            
            content.push({
                text: 'Administrator danych: Grupa ABC szalunki\n(ABC Szalunki Zbigniew Szarawarski, Maciej Szarawarski PHU PRATA, PRATA Sp. z o.o.)',
                fontSize: 8,
                color: '#666666',
                margin: [0, 5, 0, 0]
            });
            
            // Definicja dokumentu
            const docDefinition = {
                content: content,
                styles: {
                    header: {
                        fontSize: 24,
                        bold: true
                    },
                    subheader: {
                        fontSize: 14,
                        bold: true
                    },
                    sectionHeader: {
                        fontSize: 12,
                        bold: true,
                        color: '#dc2626'
                    }
                },
                footer: function(currentPage, pageCount) {
                    return {
                        columns: [
                            {
                                text: 'ABC Szalunki | ul. Skotnicka 272, 30-394 Krak√≥w | NIP: 6762382380\nwww.abcszalunki.pl | Data: ' + new Date().toLocaleDateString('pl-PL') + ' | Strona ' + currentPage + '/' + pageCount,
                                alignment: 'center',
                                fontSize: 8,
                                color: '#808080'
                            }
                        ],
                        margin: [20, 10]
                    };
                },
                pageMargins: [40, 60, 40, 50],
                defaultStyle: {
                    font: 'Roboto'
                }
            };
            
            // Zwr√≥ƒá obiekt z metodami
            return {
                save: function(filename) {
                    pdfMake.createPdf(docDefinition).download(filename);
                },
                getBase64: function() {
                    return new Promise((resolve) => {
                        pdfMake.createPdf(docDefinition).getBase64((data) => {
                            resolve('data:application/pdf;base64,' + data);
                        });
                    });
                }
            };
        }

        function showStatus(message, type) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.classList.remove('hidden', 'bg-green-100', 'bg-red-100', 'bg-blue-100', 'text-green-800', 'text-red-800', 'text-blue-800');
            
            if (type === 'success') {
                statusEl.classList.add('bg-green-100', 'text-green-800');
            } else if (type === 'error') {
                statusEl.classList.add('bg-red-100', 'text-red-800');
            } else {
                statusEl.classList.add('bg-blue-100', 'text-blue-800');
            }
            
            statusEl.textContent = message;
        }

        async function submitForm() {
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '‚è≥ Przetwarzanie...';
            button.disabled = true;

            try {
                const formData = collectFormData();
                
                // Walidacja
                if (!formData.clientType) throw new Error('Wybierz typ dzier≈ºawcy');
                if (!formData.region) throw new Error('Wybierz region');
                if (!formData.dataConsent) throw new Error('Musisz wyraziƒá zgodƒô na przetwarzanie danych osobowych');
                if (!formData.investmentName) throw new Error('Wpisz nazwƒô inwestycji');
                if (!formData.constructionAddress) throw new Error('Wpisz adres budowy');
                if (!formData.contractorName) throw new Error('Wpisz nazwƒô wykonawcy');

                showStatus('üìÑ Generowanie PDF z polskimi znakami (ƒÖ, ƒá, ƒô, ≈Ç, ≈Ñ, √≥, ≈õ, ≈∫, ≈º)...', 'info');
                
                const doc = createPDFWithNativeText(formData);
                const timestamp = new Date().toISOString().slice(0,19).replace(/:/g, '-');
                const filename = `ABC_Szalunki_Formularz_${timestamp}.pdf`;
                
                // Pobierz PDF lokalnie
                doc.save(filename);
                showStatus('‚úÖ Formularz zosta≈Ç pobrany w PDF! Wysy≈Çanie do systemu...', 'success');

                // Pobierz base64 dla uploadu
                const pdfBase64 = await doc.getBase64();
                
                await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        pdfBase64: pdfBase64,
                        filename: filename,
                        formData: formData
                    })
                });

                showStatus('‚úÖ Wys≈Çano formularz! ', 'success');

            } catch (error) {
                console.error('B≈ÇƒÖd:', error);
                showStatus('‚ö†Ô∏è ' + error.message, 'error');
            }

            button.innerHTML = originalText;
            button.disabled = false;
        }
    </script>
</body>
</html>